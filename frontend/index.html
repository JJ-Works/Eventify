<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Eventify - Connect & Explore</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/styles/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Italiana&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <style>
      .hero {
        height: 90vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        background: linear-gradient(135deg, #e0e7ff 0%, #fae8ff 100%);
      }

      .hero-title {
        font-size: 4rem;
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
        background: linear-gradient(to right, #112a46, var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .hero-subtitle {
        font-size: 1.25rem;
        color: var(--text-muted);
        margin-bottom: 2rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }
    </style>
  </head>

  <body>
    <nav class="navbar">
      <div class="container nav-content">
        <a href="index.html" class="logo"
          ><img src="./assets/images/eventLogo.jpg" alt=""
        /></a>
        <div id="navMenu">
          <!-- Injected via navbar.js -->
        </div>
      </div>
    </nav>

    <header class="hero">
      <div class="container">
        <h1 class="hero-title">Discover Events<br />That Matter To You</h1>
        <p class="hero-subtitle">
          Join a community of passionate individuals. Find local meetups,
          workshops, and gatherings in seconds.
        </p>
        <div id="heroActions">
          <a
            href="pages/dashboard.html"
            class="btn btn-primary"
            style="padding: 16px 32px; font-size: 1.2rem"
            >Explore Events</a
          >
        </div>
      </div>
    </header>

    <section
      id="recommendationsSection"
      class="container"
      style="padding: 4rem 0"
    >
      <h2
        id="recommendationTitle"
        style="
          font-size: 2rem;
          font-weight: 800;
          margin-bottom: 2rem;
          text-align: center;
        "
      >
        Latest Events
      </h2>
      <div id="recommendationsGrid" class="events-grid">
        <p style="text-align: center; grid-column: 1/-1">
          Loading awesome events...
        </p>
      </div>
    </section>

    <link rel="stylesheet" href="assets/styles/dashboard.css" />
    <script src="assets/scripts/api.js"></script>
    <script src="assets/scripts/navbar.js"></script>
    <script>
      // Simplified Recommendation Logic
      async function loadRecommendations() {
        const grid = document.getElementById("recommendationsGrid");
        const title = document.getElementById("recommendationTitle");

        console.log("Recommendation system initializing...");

        if (
          typeof window.Auth === "undefined" ||
          typeof window.API === "undefined"
        ) {
          console.error("Core scripts (api.js) not loaded yet.");
          grid.innerHTML =
            '<p style="text-align: center; grid-column: 1/-1;">Error: System core not loaded.</p>';
          return;
        }

        const user = window.Auth.getUser();

        try {
          console.log("Fetching events from backend...");
          const allEvents = await window.API.getAllEvents();
          console.log("Events received:", allEvents);

          if (
            !allEvents ||
            !Array.isArray(allEvents) ||
            allEvents.length === 0
          ) {
            console.log("No events found");
            grid.innerHTML =
              '<p style="text-align: center; grid-column: 1/-1;">No events found yet. Be the first to create one!</p>';
            return;
          }

          let displayEvents = [];

          if (user && user.interests) {
            const userInterests = user.interests
              .toLowerCase()
              .split(",")
              .map((i) => i.trim());
            displayEvents = allEvents.filter((event) => {
              return userInterests.some(
                (interest) =>
                  event.title.toLowerCase().includes(interest) ||
                  (event.description &&
                    event.description.toLowerCase().includes(interest)),
              );
            });

            if (displayEvents.length > 0) {
              title.textContent = "Recommended For You";
            }
          }

          // Fallback/Fill: Fill with latest events if no matches or to make up a set of 4
          if (displayEvents.length < 4) {
            const latest = [...allEvents].sort((a, b) => b.id - a.id);
            for (const event of latest) {
              if (displayEvents.length >= 4) break;
              if (!displayEvents.find((e) => e.id === event.id)) {
                displayEvents.push(event);
              }
            }
          } else {
            displayEvents = displayEvents.slice(0, 4);
          }

          grid.innerHTML = displayEvents
            .map(
              (event) => `
                    <div class="event-card" onclick="window.location.href='pages/event-details.html?id=${event.id}'">
                        <div class="event-header" style="${event.imageUrl ? `background-image: url('${event.imageUrl}');` : ""}">
                        </div>
                        <div class="event-body">
                            <span class="event-date">${new Date(event.eventDate).toLocaleDateString()}</span>
                            <h3 class="event-title">${event.title}</h3>
                            <div class="event-info">
                                <p>üìç ${event.location}</p>
                                <p style="margin-top: 0.5rem; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${event.description || "No description provided."}</p>
                            </div>
                            <div class="event-host" style="display: flex; align-items: center; margin-top: auto; padding-top: 1rem; border-top: 1px solid #f3f4f6;">
                                <div class="host-avatar" style="width: 32px; height: 32px; background: #e0e7ff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 0.75rem;">${event.host ? event.host.name.charAt(0) : "?"}</div>
                                <span>Hosted by ${event.host ? event.host.name : "Unknown"}</span>
                            </div>
                        </div>
                    </div>
                `,
            )
            .join("");
        } catch (err) {
          console.error("Failed to load recommendations:", err);
          grid.innerHTML =
            '<p style="text-align: center; grid-column: 1/-1;">Failed to load events. Please check your connection.</p>';
        }
      }

      document.addEventListener("DOMContentLoaded", loadRecommendations);

      // Update hero button if logged in
      if (localStorage.getItem("user")) {
        const heroActions = document.getElementById("heroActions");
        if (heroActions) {
          heroActions.innerHTML = `
                    <a href="pages/dashboard.html" class="btn btn-primary" style="padding: 16px 32px; font-size: 1.2rem;">Go to Dashboard</a>
                `;
        }
      }
    </script>
  </body>
</html>
